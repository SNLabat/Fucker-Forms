<!DOCTYPE html>
<html>
<head>
  <title>Fucker Forms (Windows 95 Style)</title>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- React / ReactDOM -->
  <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <!-- Babel for in-browser transpiling (for demos) -->
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <!-- Papa Parse for CSV -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <!-- XLSX library -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

  <style>
    /* Windows 95–inspired styles */

    /* 1) Full screen background color */
    body {
      background-color: #008080; /* teal reminiscent of Windows 95 wallpaper */
      color: #000000;
      margin: 0;
      padding: 0;
      font-family: "MS Sans Serif", Tahoma, Verdana, sans-serif;
    }

    /* 2) Container that simulates a window on top of the "desktop" */
    .container {
      background-color: #C3C7CB; /* typical Win95 window background gray */
      padding: 10px;
      border: 2px solid #FFFFFF; /* top/left edges for 3D effect */
      border-right: 2px solid #808080;
      border-bottom: 2px solid #808080;
      margin: 20px;
      width: calc(100% - 60px);
      max-width: 1200px;
      border-radius: 0; /* keep corners square for that Win95 vibe */
    }

    /* 3) Table design reminiscent of 95 with 3D headers */
    .table-container {
      background-color: #C3C7CB;
      border: 2px solid #808080;
      margin-top: 10px;
      padding: 5px;
      overflow-y: auto;
      max-height: 500px; /* or whatever you want */
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #C3C7CB; 
    }
    th {
      background: #ECE9D8; /* typical 3D face color in Win95 */
      color: #000000;
      padding: 8px;
      text-align: left;
      border: 1px solid #808080;
      border-top-color: #FFFFFF; /* top edge highlight */
      border-left-color: #FFFFFF;
      cursor: pointer;
    }
    td {
      padding: 8px;
      border-bottom: 1px solid #808080;
    }

    /* 4) Buttons - flat, 3D-ish edges */
    button {
      font-family: "MS Sans Serif", Tahoma, Verdana, sans-serif;
      font-size: 14px;
      color: #000000;
      background-color: #C3C7CB;
      border: 2px solid #808080;
      border-top-color: #FFFFFF;
      border-left-color: #FFFFFF;
      padding: 2px 8px;
      margin: 0 2px;
      cursor: pointer;
    }
    button:hover {
      background-color: #ECE9D8; 
    }

    /* 5) Inputs (file, text, number) mimic Win95 text box style */
    input[type="file"],
    input[type="text"],
    input[type="number"] {
      font-family: "MS Sans Serif", Tahoma, Verdana, sans-serif;
      font-size: 14px;
      color: #000000;
      background-color: #FFFFFF;
      border: 2px solid #808080;
      border-top-color: #FFFFFF;
      border-left-color: #FFFFFF;
      padding: 2px;
      margin-bottom: 4px;
    }

    /* 6) Title bar feeling for .header-controls? Optional */
    .header-controls {
      background: linear-gradient(to bottom, #000080, #000060);
      padding: 8px;
      color: #FFFFFF;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      border: 2px solid #808080;
      border-top-color: #FFFFFF;
      border-left-color: #FFFFFF;
    }
    .header-controls button {
      margin-bottom: 0; /* override if needed */
    }

    .filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    /* 7) We can keep instructions in a 3D panel style */
    .instructions {
      background-color: #C3C7CB;
      color: #000000;
      border: 2px solid #808080;
      border-top-color: #FFFFFF;
      border-left-color: #FFFFFF;
      padding: 10px;
      margin-top: 10px;
      max-width: 600px;
    }
    .instructions h2 {
      margin-top: 0;
      font-size: 16px;
    }
    .instructions ol {
      margin: 8px 0;
      padding-left: 20px;
    }

    /* 8) Error box can mimic a Win95 message box style */
    .error-box {
      background-color: #C3C7CB;
      color: #000000;
      border: 2px solid #808080;
      border-top-color: #FFFFFF;
      border-left-color: #FFFFFF;
      padding: 10px;
      margin-top: 10px;
      max-width: 700px;
    }
    .error-box h2 {
      margin-top: 0;
      color: #ff0000;
      font-size: 16px;
    }

    /* 9) Optionally, create a "taskbar" at bottom? */
    .taskbar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 30px;
      background-color: #C3C7CB;
      border-top: 2px solid #808080;
      border-right: 2px solid #808080;
      border-bottom: 2px solid #FFFFFF;
      border-left: 2px solid #FFFFFF;
      display: flex;
      align-items: center;
      font-family: "MS Sans Serif", Tahoma, Verdana, sans-serif;
      color: #000000;
    }
    .taskbar .start-button {
      margin-left: 4px;
      background-color: #C3C7CB;
      border: 2px solid #808080;
      border-top-color: #FFFFFF;
      border-left-color: #FFFFFF;
      padding: 0 8px;
      cursor: pointer;
      height: 22px;
      display: flex;
      align-items: center;
      font-size: 14px;
    }
    .taskbar .start-button:hover {
      background-color: #ECE9D8;
    }
    .taskbar .time {
      margin-left: auto;
      margin-right: 8px;
      font-size: 14px;
    }

  </style>
</head>
<body>

  <!-- If you want the "taskbar" at the bottom -->
  <div class="taskbar">
    <button class="start-button">Start</button>
    <div class="time" id="taskbar-time">--:--</div>
  </div>

  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;
    const XLSXLib = window.XLSX;
    const PapaLib = window.Papa;

    // We'll replicate your existing code. Just focusing on the UI changes.

    function App() {
      // State and logic the same as your existing code...
      const [data, setData] = useState([]);
      const [columns, setColumns] = useState([]);
      const [sortConfig, setSortConfig] = useState({ key: null, direction: 'asc' });
      const [filters, setFilters] = useState({});
      const [rowColors, setRowColors] = useState({});
      const [sortDirection, setSortDirection] = useState('asc');
      const [errorMessage, setErrorMessage] = useState('');

      // For demonstration:
      const REQUIRED_COLUMN = 'amount';

      function resetState() {
        setData([]);
        setColumns([]);
        setRowColors({});
        setFilters({});
        setSortConfig({ key: null, direction: 'asc' });
      }

      const hasValidData = useMemo(() => {
        return columns.includes(REQUIRED_COLUMN) && data.length > 0;
      }, [columns, data]);

      function showError(msg) {
        setErrorMessage(msg);
      }

      function clearError() {
        setErrorMessage('');
      }

      function handleFileUpload(e) {
        // Implementation for handleFileUpload
        // ...
        // Keep your existing parse logic
      }

      function handleRowColor(uniqueKey, color) {
        // keep your logic
      }

      function handleContributedChange(uniqueKey, val) {
        // keep your logic
      }

      function handleFilter(col, val) {
        // keep your logic
      }

      function handleAmountSort() {
        // keep your logic
      }

      function handleSort(col) {
        // keep your logic
      }

      function handleSave() {
        // keep your logic
      }

      // Potential time display for the "taskbar"
      const [currentTime, setCurrentTime] = useState('');
      useEffect(() => {
        const timer = setInterval(() => {
          const now = new Date();
          let hours = now.getHours();
          let minutes = now.getMinutes();
          const ampm = hours >= 12 ? 'PM' : 'AM';
          hours = hours % 12;
          hours = hours || 12; // 12-hour format
          const minStr = minutes < 10 ? '0' + minutes : minutes;
          setCurrentTime(`${hours}:${minStr} ${ampm}`);
        }, 1000);
        return () => clearInterval(timer);
      }, []);

      // Then in the return, the container is your "window"
      return (
        <div className="container">

          {/* Title-bar style header */}
          <div className="header-controls">
            <input type="file" accept=".csv,.xlsx" onChange={handleFileUpload} />
            <button
              className="save-button"
              onClick={handleSave}
              disabled={!hasValidData}
            >
              Save Current View
            </button>
          </div>

          <div className="filters-and-sort">
            <div className="filters">
              {['action', 'description', 'done_at', 'amount', 'difference'].map(col => (
                columns.includes(col) && (
                  <div key={col}>
                    <label>{col}: </label>
                    <input
                      type="text"
                      onChange={e => handleFilter(col, e.target.value)}
                      placeholder={`Filter ${col}...`}
                      disabled={!hasValidData}
                    />
                  </div>
                )
              ))}
            </div>
            <button
              className="sort-button"
              onClick={handleAmountSort}
              disabled={!columns.includes('amount') || !hasValidData}
            >
              Sort Amount {sortDirection === 'asc' ? '↑' : '↓'}
            </button>
          </div>

          <div className="table-container">
            <table>
              <thead>
                <tr>
                  <th>Row Actions</th>
                  {columns.map(col => (
                    <th
                      key={col}
                      onClick={() => handleSort(col)}
                    >
                      {col}
                      {sortConfig.key === col && (
                        sortConfig.direction === 'asc' ? ' ↑' : ' ↓'
                      )}
                    </th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {data.map(row => {
                  const highlightClass = row.rowColor ? `row-${row.rowColor}` : '';
                  return (
                    <tr key={row._uniqueKey} className={highlightClass}>
                      <td>
                        <button onClick={() => handleRowColor(row._uniqueKey, 'green')}>Green</button>
                        <button onClick={() => handleRowColor(row._uniqueKey, 'yellow')}>Yellow</button>
                        <button onClick={() => handleRowColor(row._uniqueKey, 'red')}>Red</button>
                        <button onClick={() => handleRowColor(row._uniqueKey, 'clear')}>Clear</button>
                      </td>
                      {columns.map((col) => {
                        if (col === 'rowColor') {
                          return <td key={col}>{row.rowColor}</td>;
                        }
                        if (col === 'contributed') {
                          return (
                            <td key={col}>
                              <input
                                type="text"
                                value={row.contributed || ''}
                                onChange={e => handleContributedChange(row._uniqueKey, e.target.value)}
                              />
                            </td>
                          );
                        }
                        return <td key={col}>{row[col]}</td>;
                      })}
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>

          <div className="instructions">
            <h2>Instructions (Windows 95 Style):</h2>
            <ol>
              <li>Select a CSV or XLSX (case-insensitive “amount” column).</li>
              <li>Filter/sort, color rows, etc. in a nostalgic UI!</li>
              <li>Click "Save Current View" to export .xlsx with your color coding.</li>
            </ol>
          </div>

          {errorMessage && (
            <div className="error-box">
              <h2>Error</h2>
              <p>{errorMessage}</p>
            </div>
          )}
        </div>
      );
    }

    // Render App into #root
    ReactDOM.render(<App />, document.getElementById('root'));

    // Optional: update the "taskbar" time
    const timeElem = document.getElementById('taskbar-time');
    if (timeElem) {
      setInterval(() => {
        const now = new Date();
        let hours = now.getHours();
        let minutes = now.getMinutes();
        const ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours || 12; 
        const minStr = minutes < 10 ? '0' + minutes : minutes;
        timeElem.textContent = `${hours}:${minStr} ${ampm}`;
      }, 1000);
    }

  </script>
</body>
</html>
